---
title: "bah∆ telomeres"
author: "Molly Brothers"
date: "7/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(data.table)
library(tidyverse)
```


```{r bah∆ telomeres, fig.height=3, fig.width=8}
plot_loess <- function(d0, d1, d2, d3, ch, b, e){
  region_methyl_0 <- d0[chrom == ch & start > b & start < e]
  lo_methyl_0 <- loess(percentage ~ start, data = region_methyl_0, weights = region_methyl_0$coverage, enp.target = 100)
  
  region_methyl_1 <- d1[chrom == ch & start > b & start < e]
  lo_methyl_1 <- loess(percentage ~ start, data = region_methyl_1, weights = region_methyl_1$coverage, enp.target = 100)
  
  region_methyl_2 <- d2[chrom == ch & start > b & start < e]
  lo_methyl_2 <- loess(percentage ~ start, data = region_methyl_2, weights = region_methyl_2$coverage, enp.target = 100)
  
  region_methyl_3 <- d3[chrom == ch & start > b & start < e]
  lo_methyl_3 <- loess(percentage ~ start, data = region_methyl_3, weights = region_methyl_3$coverage, enp.target = 100)
  
  plot(x=lo_methyl_0$x[order(lo_methyl_0$x)], y=lo_methyl_0$fitted[order(lo_methyl_0$x)], 
     type = 'l', lwd=2, ylim = c(0,100), col = "mediumpurple4", frame.plot = FALSE,
     xlab = "", ylab = "")
  lines(x=lo_methyl_1$x[order(lo_methyl_1$x)], y=lo_methyl_1$fitted[order(lo_methyl_1$x)],
      type = 'l', lwd=2, ylim = c(0,100), col = "black")
  lines(x=lo_methyl_2$x[order(lo_methyl_2$x)], y=lo_methyl_2$fitted[order(lo_methyl_2$x)],
      type = 'l', lwd=2, ylim = c(0,100), col = "deeppink")
  lines(x=lo_methyl_3$x[order(lo_methyl_3$x)], y=lo_methyl_3$fitted[order(lo_methyl_3$x)],
      type = 'l', lwd=2, ylim = c(0,100), col = "darkturquoise")
  box(bty="l")
}

# DATA
columns <- c("chrom", "start", "end", "name", "score", 
             "strand", "startCodon", "stopCodon", "color", 
             "coverage", "percentage")
select_cols <- c("chrom", "start", "coverage", "percentage")

# SIR3-EcoGII
methyl_wt <- fread("/home/mbrothers/nanopore/210706_Fireworks/modified_bases.aggregate09.6mA.bed",
                col.names = columns)
methyl_filtered_wt <- methyl_wt[coverage > 10, ..select_cols]

# sir3∆::EcoGII
methyl_D <- fread("/home/mbrothers/nanopore/210706_Fireworks/modified_bases.aggregate10.6mA.bed",
                col.names = columns)
methyl_filtered_D <- methyl_D[coverage > 10, ..select_cols]

# sir3-bah∆::EcoGII
methyl_bah <- fread("/home/mbrothers/nanopore/210706_Fireworks/modified_bases.aggregate11.6mA.bed",
                col.names = columns)
methyl_filtered_bah <- methyl_bah[coverage > 10, ..select_cols]

# sir3-wH∆::EcoGII
methyl_wh <- fread("/home/mbrothers/nanopore/210706_Fireworks/modified_bases.aggregate12.6mA.bed",
                col.names = columns)
methyl_filtered_wh <- methyl_wh[coverage > 10, ..select_cols]

# tel01L
plot_loess(methyl_filtered_wt, methyl_filtered_D, methyl_filtered_bah, methyl_filtered_wh, "I", 0, 15e3)
abline(v = c(801, 337, 336, 63, 62, 1))

#tel02L
plot_loess(methyl_filtered_wt, methyl_filtered_D, methyl_filtered_bah, methyl_filtered_wh, "II", 0, 15e3)
abline(v = c(6608, 6139, 6138, 5849, 5848, 1))

#tel04R
plot_loess(methyl_filtered_wt, methyl_filtered_D, methyl_filtered_bah, methyl_filtered_wh, "IV", 1531933-15000, 1531933)
abline(v = c(1524625, 1525089, 1525090, 1525370, 1525467, 1531933))

#tel13L
plot_loess(methyl_filtered_wt, methyl_filtered_D, methyl_filtered_bah, methyl_filtered_wh, "XIII", 0, 15e3)
abline(v = c(6344, 5875, 5874, 5586, 5585, 5538, 5537, 52, 51, 1))
```
